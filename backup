#!/usr/bin/env bash

SERVNAME="$(hostnamectl hostname)"
CFGS_DIR="/home/svlad/.local/var/lib/fastmail/backup"
CFGS_PACK="${CFGS_DIR}/dotfiles/$(date +%Y%m%d-%H%M%S)-${SERVNAME}.tar.xz"

mkdir -p "$(dirname ${CFGS_PACK})"

( cd /home/svlad/Sources/dotfiles
  git ls-files | tar --create --preserve-permissions --xz --file="${CFGS_PACK}" --directory="/home/svlad" --files-from -
)

echo $(groups svlad) > "${CFGS_DIR}/dotfiles/groups.list"
cp "${CFGS_PACK}" "${CFGS_DIR}/dotfiles-${SERVNAME}-latest.tar.xz"
